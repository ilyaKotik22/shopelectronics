generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // –∏–ª–∏ mysql / sqlite,
  

}

//////////////////////////////////////////////////////
// ENUMS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
//////////////////////////////////////////////////////

enum Currency {
  RUB
  USD
  EUR
}

//////////////////////////////////////////////////////
// –û–°–ù–û–í–ù–´–ï –ú–û–î–ï–õ–ò
//////////////////////////////////////////////////////

model Category {
  slug      String   @id                // smartfony-i-fototekhnika
  value     String                       // smartphones-and-photo
  name      String                       // –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ —Ñ–æ—Ç–æ
  products  Product[]
}

model Brand {
  id        String    @id @default(cuid())
  name      String    @unique
  products  Product[]
}

model Product {
  id            String   @id @default(cuid())
  title         String
  description   String?
  price         Int
  currency      Currency @default(RUB)
  rating        Float?
  available     Boolean  @default(true)

  categorySlug  String
  category      Category @relation(fields: [categorySlug], references: [slug])

  brandId       String?
  brand         Brand?   @relation(fields: [brandId], references: [id])
  basketItems   BasketItem[]   // ‚Üê –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
  attributes    ProductAttribute[]

  // üîΩ –û–ë–†–ê–¢–ù–´–ï –°–í–Ø–ó–ò
  laptopSpec     LaptopSpec?
  smartphoneSpec SmartphoneSpec?
  tvSpec         TvSpec?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([price])
  @@index([categorySlug])
}


//////////////////////////////////////////////////////
// –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –§–ò–õ–¨–¢–†–´ (checkbox)
//////////////////////////////////////////////////////

model ProductAttribute {
  id        String   @id @default(cuid())

  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  key       String   // ram, storage, screen_type, wifi_standard
  value     String   // "8 –ì–ë", "AMOLED", "Wi-Fi 6"

  @@index([key])
  @@index([key, value])
  @@index([productId])
}

//////////////////////////////////////////////////////
// (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û) –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–ò –ü–û–î –ö–ê–¢–ï–ì–û–†–ò–ò
// –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–∑–∂–µ –±–µ–∑ –ª–æ–º–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
//////////////////////////////////////////////////////

model LaptopSpec {
  productId  String  @id
  product    Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  cpu        String
  ramGb      Int
  storageGb Int
  gpu        String?
}

model SmartphoneSpec {
  productId   String  @id
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  screenInch  Float?
  batteryMah  Int?
  cameraMp    Int?
  refreshHz   Int?
  waterproof  String?
}

model TvSpec {
  productId   String  @id
  product     Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  screenInch  Int?
  resolution  String
  panelType   String
  refreshHz   Int?
  smartTv     Boolean
}


model User {
  id        String   @id @default(uuid())   // –∏–ª–∏ Int @id @default(autoincrement())
  login     String   @unique
  password  String   // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å!
  
  // –î—Ä—É–≥–∏–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –µ—Å—Ç—å
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –°–≤—è–∑—å —Å –∫–æ—Ä–∑–∏–Ω–æ–π (–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É)
  basket    Basket?  @relation("UserBasket")
}

model Basket {
  id        String   @id @default(uuid())
  
  userId    String   @unique
  user      User     @relation("UserBasket", fields: [userId], references: [id], onDelete: Cascade)

  // –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
  items     BasketItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BasketItem {
  id        String   @id @default(uuid())

  basketId  String
  basket    Basket   @relation(fields: [basketId], references: [id], onDelete: Cascade)

  productId String   // –∏–ª–∏ Int ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ —É —Ç–µ–±—è id –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  product   Product  @relation(fields: [productId], references: [id]) 
  
  quantity  Int      @default(1)

  // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ –º–æ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)
  priceAtAdd Decimal? @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([basketId, productId])   // –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–≤–∞—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤–∞–∂–¥—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
}